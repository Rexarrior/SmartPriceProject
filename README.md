# SmartPriceProject
# Проект "Умные ценники". 

Выполняется студентами ПМПУ СПБГУ для IoT Академии Samsung в 2020 году. 
### Состав проектной команды:
* Родионов Александр
* Киреев Сергей 

### Презентация проекта
* [ИОТ Умные Ценники](https://docs.google.com/presentation/d/1CsZbk4YONBEhG9cXoQ8nCgpMzJ0dXboU5oR-GBdHOWk/edit#slide=id.p "")


### Архитектура проекта следующая:
* Сервер системы умных ценников. 
* База данных системы умных ценников. Связана с базой данных организации-магазина. 
* Станции-полки - устройства, призванные управлять массивом умных ценников, соответствующих одной полке. Выполняются в двух вариантах - автономные и с постоянным питанием от эллектрической сети. Осуществвляют связь с сервером системы посредством интерфейса беспроводной связи. 
* Умные ценники - E-inc экраны, отображающие актуальную (согласно базе данных магазина) цену на товар, за которым закреплены. Располагаются на общей шине, ведущей к станции. Управляются по интерфейсу spi. 
* Сканер штрих кода. Вспомогательное устройство, предназначенное для упрощения настройки ценника на товар. Настройка осуществляется по следующему алгоритму: выполняется скнирование штрих-кода ценника, выполняется сканирование штрих-кода товара. Информация отсылается на сервер, сервер производит сопоставление в базе и передает на станцию, соответствующую настраиваемому ценнику, информацию о новом товаре и цене на него. 

### Сервер
* Для работы сервера необходимо установать Microsoft Access Database Engine 2016, соответствующий разрядности вашей ОС.
* БД, с которой работает сервер, должна иметь 2 таблицы со связью 1 ко многим от первой таблицы ко второй по полю device_id:
    * Devices с полем device_id
    * Products с полями product_id, price, device_id
* Сервер принимает 1 байт - номер ценнка, а возвращает массив чёрно-белых пикселей (массив бит), соответствующих изображению цифры с ценой товара (в данный момент все цены одноразрядные). Пиксели подаются по столбцам сверху вниз, от самого левого столбца к самому правому.
* Изображения сервер берёт из локального хранилища (путь к ним должен быть прописан в файле config.txt, см. ниже). Формат файла - .bmp, 1 бит на пиксель. Оригинальные размеры иображений: 204 пикселя в ширину, 112 пикселей в высоту. Однако храниться изображения должны повёрнутыми на 90 градусов против часовой стрелки и отраженными (flipped) по вертикали.
* В папке с приложением сервера должен находиться файл config.txt следующего формата:
    * Первая строка - путь к базе данных
    * Последующие 10 строк - пути к .bmp-изображениям от 0 до 9
    * Последняя строка - путь к изображению, соответствующему ошибке в БД (товара ценнику не назначено или назначено больше одного)

### На текущей стади Проект выполняется в формате прототипа. Прототип включает в себя следующее:
* Сервер системы умных ценников с минимальным функционалом
* База данных системы умных ценников с интегрированной в нее минимальной базой о товарах магазина
* Прототип станции с подключенным к ней одним умным ценником. Включает в себя следующие аппаратные элементы:
    * [stm32l152RCT6-Discovery](https://www.st.com/en/evaluation-tools/32l152cdiscovery.html "") в качестве контроллера и основной платы станции
    * e-inc дисплей [DEW0213T5](http://www.e-paper-display.com/products_detail/productId=309.html "") от компании GoodDisplay в качестве умного ценника
    * адаптер дисплея [DESPI-CO2](http://www.e-paper-display.com/products_detail/productId=403.html "")
    * Li-ion аккумулятор в качестве автономного источника питания
    * [ESP01](https://www.chipdip.ru/product/esp-01 "") в качестве интерфейса беспроводной связи (wifi)

    
